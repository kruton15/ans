<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‡πÄ‡∏â‡∏•‡∏¢‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏Ñ2</title>

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#f2f5fb;
  text-align:center;
}
h3{margin:12px;color:#333}

#scanner{
  width:300px;height:200px;
  margin:10px auto;
  border-radius:18px;
  overflow:hidden;
  border:4px solid #5b7cfa;
  box-shadow:0 8px 18px rgba(0,0,0,.15);
}
video{width:100%;height:100%;object-fit:cover}

#status{
  font-size:14px;
  color:#5b7cfa;
  margin:6px 0;
}

#out{
  max-width:350px;
  margin:12px auto;
  background:#fff;
  border-radius:16px;
  padding:14px;
  box-shadow:0 6px 16px rgba(0,0,0,.1);
  text-align:left;
  font-size:15px;
  line-height:1.65;
}

.badge{
  display:inline-block;
  background:#5b7cfa;
  color:#fff;
  padding:4px 10px;
  border-radius:999px;
  font-size:13px;
  margin-bottom:8px;
}
.error{color:#d33}
</style>
</head>

<body>
<h3>üì∏ ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</h3>

<div id="scanner">
  <video id="v" autoplay playsinline></video>
</div>

<div id="status">üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô‚Ä¶</div>
<div id="out"></div>

<script>
const v=document.getElementById("v"),
      out=document.getElementById("out"),
      status=document.getElementById("status");

let last="";

if(!("BarcodeDetector" in window)){
  status.innerHTML="‚ùå ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô";
  throw "";
}

(async()=>{
  let stream=await navigator.mediaDevices.getUserMedia({
    video:{facingMode:"environment"}
  });
  v.srcObject=stream;

  let detector=new BarcodeDetector();
  setInterval(async()=>{
    let b=await detector.detect(v);
    if(b.length){
      let val=b[0].rawValue;
      if(val!==last){
        last=val;
        calc(val);
      }
    }
  },700);
})();

function f(x){
  let n = Number(x);

  // ‡∏õ‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
  let s = n.toFixed(2);

  // ‡∏ñ‡πâ‡∏≤ .00 ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á
  if(s.endsWith(".00")){
    s = s.slice(0,-3);
  }else{
    // ‡∏ï‡∏±‡∏î 0 ‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î ‡πÄ‡∏ä‡πà‡∏ô 12.50 ‚Üí 12.5
    s = s.replace(/0+$/,'').replace(/\.$/,'');
  }

  // ‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ , ‡∏´‡∏•‡∏±‡∏Å‡∏û‡∏±‡∏ô
  let parts = s.split(".");
  parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  return parts.join(".");
}

function calc(x){
  // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Code 39 (IDAutomation)
  x = x.replace(/\*/g, "");

  if(!/^\d{21,}$/.test(x)){
    status.innerHTML="‚ùå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
    out.innerHTML="";
    return;
  }

  status.innerHTML="‚úÖ ‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";

  // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡πà‡∏≤
  let n1=parseInt(x.slice(0,3));
  let n2=parseInt(x.slice(3,5));
  let n3=parseInt(x.slice(5,7));
  let n4=parseInt(x.slice(7,9));
  let n5=parseInt(x.slice(9,11));
  let n6=parseInt(x.slice(11,13));
  let n7=parseInt(x.slice(13,15));
  let n8=parseInt(x.slice(15,17));
  let n9=parseInt(x.slice(17,20));
  let n10=parseInt(x.slice(20));

  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
  let a1=(180-n1)/2;
  let a2=n2-(15.3*2);
  let a3=(n3+0.7)*4;
  let a4=180-103-n4;
  let a5=(n5*18)+(18*5);
  let a61=2*22/7*n6*3/4+(n6*2);
  let a62=22/7*n6*n6*3/4;
  let a7=14*22*n7*2/3;
  let a8=3+(n8-1)*4;
  let a9=n9*4;
  let a10=n9*2/3;

  out.innerHTML=`
  <div class="badge">‡πÄ‡∏â‡∏•‡∏¢‡∏â‡∏ö‡∏±‡∏ö‡∏ó‡∏µ‡πà ${n10}</div><br>
  ‡∏Ç‡πâ‡∏≠ 1) ${f(a1)}¬∞<br>
  ‡∏Ç‡πâ‡∏≠ 2) ${f(a2)} ‡∏ã‡∏°.<br>
  ‡∏Ç‡πâ‡∏≠ 3) ${f(a3)} ‡∏°.<br>
  ‡∏Ç‡πâ‡∏≠ 4) ${f(a4)}¬∞<br>
  ‡∏Ç‡πâ‡∏≠ 5) ${f(a5)} ‡∏ï‡∏£.‡∏ã‡∏°.<br>
  ‡∏Ç‡πâ‡∏≠ 6.1) ${f(a61)} ‡∏ã‡∏°.<br>
  ‡∏Ç‡πâ‡∏≠ 6.2) ${f(a62)} ‡∏ï‡∏£.‡∏ã‡∏°.<br>
  ‡∏Ç‡πâ‡∏≠ 7) ${f(a7)} ‡∏•‡∏ö.‡∏ã‡∏°.<br>
  ‡∏Ç‡πâ‡∏≠ 8) ${f(a8)}<br>
  ‡∏Ç‡πâ‡∏≠ 9) ${f(a9)} ‡∏ö‡∏≤‡∏ó<br>
  ‡∏Ç‡πâ‡∏≠ 10) ${f(a10)} ‡∏ö‡∏≤‡∏ó
  `;
}
</script>
</body>
</html>
